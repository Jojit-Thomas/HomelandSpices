{{!-- <form id="paymentForm" method="post">
    <input required type="radio" name="paymentMethod" value="cashOnDelivery" id="">
    <label for="paymentMethod">Cash On Delivery</label>
    <input required type="radio" name="paymentMethod" value="razorPay" id="">
    <label for="paymentMethod">Razor Pay</label>
    <input required type="radio" name="paymentMethod" value="paypal" id="">
    <label for="paymentMethod">Paypal</label>
    <div id="paypal-button-container"></div>
    <button type="submit" id="checkout" class="btn btn-primary">Proceed to Checkout</button>
</form>
 --}}























<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
  crossorigin="anonymous"
/>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
  crossorigin="anonymous"
></script>
<style>
  .bg_purple { background-color: #9155fd; } .purple { color: #766edb; } .purplec
  { color: #9155fd; } .a-none { text-decoration: none; } input[type="radio"] {
  width: 18px; height: 18px; } .breadcrumb-item + .breadcrumb-item::before {
  margin: 0 1vw; content: var(--bs-breadcrumb-divider, " > "); }
  .breadcrumb-item { font-size: large; font-weight: 700; } .address { word-wrap:
  break-word; /* overflow-wrap: break-word; */ } @media screen and (min-width:
  768px) { .options { margin: auto 0; } .outer{ padding: 1rem 3rem; } } @media
  screen and (max-width: 768px) { .options { margin: 1rem 2.6rem; } .outer{
  padding: 1rem 1rem; } }
</style>
<form action="/address" method="post">
  <div class="container pt-5 d-flex flex-wrap">
    <div class="col-lg-9 col-sm-12 col-12 outer">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb py-4">
          <li class="breadcrumb-item" aria-current="page">
            Address
          </li>
          {{!-- <li class="breadcrumb-item text-muted">Shipping</li> --}}
          <li class="breadcrumb-item text-muted">
            Payment
          </li>
        </ol>
      </nav>
      <!-- ================================================================================ -->
      <div class="accordion" id="accordionExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        Accordion Item #1
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
      <div class="accordion-body">
 <input required type="radio" name="paymentMethod" value="cashOnDelivery" id="">
    <label for="paymentMethod">Cash On Delivery</label>      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        Accordion Item #2
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
      <div class="accordion-body">
<input required type="radio" name="paymentMethod" value="razorPay" id="">
    <label for="paymentMethod">Razor Pay</label>
    
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
        Accordion Item #3
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body">
<input required type="radio" name="paymentMethod" value="paypal" id="">
    <label for="paymentMethod">Paypal</label>
    <div id="paypal-button-container"></div>      </div>      </div>
    </div>
  </div>
</div>  
      <!-- ================================================================================ -->
      {{!-- <div class="d-flex justify-content-between mb-5 w-100 flex-wrap">
        <div class="d-flex col-12 col-sm-8">
          <input required
            type="radio"
            name="address"
            class="my-auto me-4 col-1 col-sm-1"
          />
          <div class="col-11 col-sm-11">
            <h4>Abhisek</h4>
            <p class="mb-0 address">Vadakkemadam house, palakkad</p>
            <p class="mb-0">
              <span class="text-muted">Contact - </span>9947XXXXX
            </p>
          </div>
        </div>
        <div class="d-flex col-12 col-sm-4 options" id="" style="width: 10rem">
          <a href=" /Address/Edit" class="text-dark a-none">Edit</a>
          <span class="mx-3">|</span>
          <a href=" /Address/Remove" class="text-danger a-none"> Remove</a>
        </div>
      </div> --}}

      <!-- ================================================================================ -->
      <hr />
    </div>
    <div
      class="col-lg-3 col-sm-12 col-12 p-4 mt-5 border border-1"
      style="height: 500px"
    >
      <h3 class="mb-4">Order Summary</h3>
      <div class="d-flex justify-content-between w-100">
        <p>Price</p>
        <p>₹{{total}}</p>
      </div>
      <div class="d-flex justify-content-between w-100">
        <p>Discount</p>
        <p>- ₹0.00</p>
      </div>
      <div class="d-flex justify-content-between w-100">
        <p>Shipping</p>
        <p class="text-purple">Free</p>
      </div>
      <div class="d-flex justify-content-between w-100">
        <p>Coupon Applied</p>
        <p>₹0.00</p>
      </div>
      <hr />
      <div class="d-flex justify-content-between w-100">
        <p class="text-purple">TOTAL</p>
        <p class="text-purple">₹{{total}}</p>
      </div>
      <p>Estimated Delivery by <span class="fw-bold">01 Aug 2022</span></p>
      <input type="text" name="coupon" class="form-control" placeholder="Coupon Code" />
      <button class="btn bg_purple text-white w-100 mt-3">CONTINUE TO PAYMENT</button>
    </div>
  </div>
</form>































































<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{{!-- <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>  --}}
  <script >
$("#paymentForm").submit((e) => {
  e.preventDefault()
  $.ajax({
    url: '/checkout',
    method: 'post',
    data: $('#paymentForm').serialize(),
    success: (response) => {
      console.log("response is :  ", response)
      if (response.method == "cod") {
        Swal.fire("Hurray !", "Your order has been placed", "success").then((state) => {
          state.isConfirmed ? location.href = '/' : null
        })
      } else if (response.method == "paypal") {

        Swal.fire("Hurray !", "Your order has been placed", "success").then((state) => {
          state.isConfirmed ? location.href = '/' : null
        })
      }
      
      else {
        razorPayment(response.res)
      }

    }
  })
})

function razorPayment(order) {
    console.log(order)
  var options = {
    "key": "rzp_test_8JLZOZRODQ9Mpc", // Enter the Key ID generated from the Dashboard
    "amount": parseInt(order.amount), // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Homeland Spices",
    "description": "Test Transaction",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function(response) {

      verifyPayment(response, order)
    },
    "prefill": {
      "name": "Jojit Thomas",
      "email": "jojitthomas.info@gmail.com",
      "contact": "9947337790"
    },
    "notes": {
      "address": "Razorpay Corporate Office"
    },
    "theme": {
      "color": "#3399cc"
    }
  };
  var rzp1 = new Razorpay(options);
  rzp1.open();

  function verifyPayment(response, order) {
    $.ajax({
      url: "/payment/verify",
      data: {
        response,
        order
      },
      method: 'post',
      success: (response) => {
        if (response.status) {
          Swal.fire("Hurray !", "Your order has been placed", "success").then((state) => {
          state.isConfirmed ? location.href = '/' : null
        })
        } else {
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'Something went wrong!',
        }).then((state) => {
          state.isConfirmed ? location.href = '/' : null
        })
        }
      }
    })
  }
}
  </script>
  <script src="https://www.paypal.com/sdk/js?client-id=AQVb1x9c8x-8KRWAB7HMhWnn7QVr2wFOjNXRiEvK7duoDBVWvFo3sPewxuRTES51JAdNV9FOkDbxVXQU&currency=USD"></script>
    <!-- Set up a container element for the button -->
    
    <script>
       paypal
        .Buttons({
          // Sets up the transaction when a payment button is clicked
          createOrder: function (data, actions) {
            return fetch("/api/orders", {
              method: "post",
              // use the "body" param to optionally pass additional order information
              // like product ids or amount
            })
              .then((response) => response.json())
              .then((order) => order.id);
          },
          // Finalize the transaction after payer approval
          onApprove: function (data, actions) {
            return fetch(`/api/orders/${data.orderID}/capture`, {
              method: "post",
            })
              .then((response) => response.json())
              .then((orderData) => {
                // Successful capture! For dev/demo purposes:
                console.log(
                  "Capture result",
                  orderData,
                  JSON.stringify(orderData, null, 2)
                );
                var transaction =
                  orderData.purchase_units[0].payments.captures[0];
                alert(
                  "Transaction " +
                    transaction.status +
                    ": " +
                    transaction.id +
                    "\n\nSee console for all available details"
                );
                $(document).ready(function (){
                $("#checkout").trigger("click");
                })
                // When ready to go live, remove the alert and show a success message within this page. For example:
                // var element = document.getElementById('paypal-button-container');
                // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                // Or go to another URL:  actions.redirect('thank_you.html');
              });
          },
        })
        .render("#paypal-button-container");
    </script>